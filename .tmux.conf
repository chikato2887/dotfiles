# ==============================================================================
# 基本設定 (Basic)
# ==============================================================================
set -g prefix C-a
unbind C-b
bind C-a send-prefix

# 24-bit color対応 (Vim/kanagawa用)
set -g default-terminal "screen-256color"
set-option -ga terminal-overrides ",xterm-256color:Tc"

# マウス操作有効
set -g mouse on

# 入力モード（リネーム時など）をVimキーバインドに
set-window-option -g status-keys vi

# ==============================================================================
# 移動操作 (Navigation)
# ==============================================================================

# 1. ウィンドウ（タブ）移動：prefix + 矢印キー
# ブラウザのタブを切り替える感覚で
bind-key -r Left previous-window
bind-key -r Right next-window

# 2. ペイン移動：hjkl (Vim操作)
# prefix + h/j/k/l で画面内を移動
bind h select-pane -L
bind j select-pane -D
bind k select-pane -U
bind l select-pane -R

# 3. セッション一覧：s (Select)
# 一覧の中でも hjkl で移動、d で削除、Enter/l で決定
bind-key s choose-tree -Z
bind-key -T choose-tree-view d send-keys x
bind-key -T choose-tree-view l send-keys Enter

# ==============================================================================
# ウィンドウ作成・リネーム
# ==============================================================================

# 1. 新規ウィンドウ作成：Ctrl+a -> n (New)
# デフォルトの c を無効化し、n に割り当てます
unbind c
bind n new-window -c "#{pane_current_path}"

# 2. ウィンドウ名の変更：Ctrl+a -> r (Rename)
bind-key r command-prompt "rename-window '%%'"

# 3. セッション名の変更：Ctrl+a -> Ctrl+r (Session Rename)
bind-key C-r command-prompt "rename-session '%%'"

# ==============================================================================
# その他の便利機能
# ==============================================================================

# 画面分割：- と | (直感操作)
bind - split-window -v -c "#{pane_current_path}"
bind '\' split-window -h -c "#{pane_current_path}"

# ペイン削除：Ctrl+a -> Backspace (delete)
bind-key BSpace confirm-before -p "kill-pane #P? (y/n)" kill-pane

# ヤンク設定 (Vim Mode)
set-window-option -g mode-keys vi
bind-key -T copy-mode-vi v send-keys -X begin-selection
bind-key -T copy-mode-vi y send-keys -X copy-pipe-and-cancel "pbcopy"

# ==============================================================================
# デザイン設定 (Kanagawa-Dragon Theme)
# ==============================================================================

# ステータスバー全体の背景と文字色 (Sumimi)
set -g status-style "bg=#181816,fg=#c8c093"

# 左側：セッション名 (DragonBlue)
set -g status-left "#[fg=#181816,bg=#2d4f67,bold] #S #[default] "

# 今いるウィンドウ（タブ）の強調：ブラウザのタブ風
set -g window-status-current-format "#[fg=#181816,bg=#ff9e3b,bold] ◀ #I:#W ▶ #[default]"
set -g window-status-format " #I:#W "

# 右側：日時
set -g status-right "#[fg=#c8c093,bg=#282828] %Y-%m-%d %H:%M "

# アクティブなペインの枠 → 下のセクションで設定

# ==============================================================================
# ペインの視認性向上：明暗はっきり＆境界線の馴染ませ
# ==============================================================================

# 1. 背景色の明暗差を強化
# 非アクティブ：明確に暗くして差をつける
set -g window-style 'bg=#1a1a19'
# アクティブ：本来の背景色 (Sumimi : #181816) より少し明るく
set -g window-active-style 'bg=#282828'

# 2. 境界線を太く＆色でハッキリ区別
set -g pane-border-lines heavy
# 非アクティブな境界線：背景に溶け込む暗色
set -g pane-border-style "fg=#1c1c1a"
# アクティブな境界線：オレンジで太く目立つ
set -g pane-active-border-style "fg=#ff9e3b,bold"

# 3. ペイン番号の表示（視覚的なダメ押し）
# prefix + q を押した時の数字も Kanagawa カラーに
set -g display-panes-active-colour "#ff9e3b" # オレンジ
set -g display-panes-colour "#2d4f67"        # ドラゴンブルー

# ------------------------------------------------------------------------------
# ペインのリサイズ：prefix + Ctrl + h/j/k/l
# ------------------------------------------------------------------------------
bind -r C-h resize-pane -L 5
bind -r C-j resize-pane -D 5
bind -r C-k resize-pane -U 5
bind -r C-l resize-pane -R 5

# ------------------------------------------------------------------------------
# ペインの入れ替え：prefix + J/K (Swap)
# ------------------------------------------------------------------------------
bind H swap-pane -t '{left-of}'
bind J swap-pane -t '{down-of}'
bind K swap-pane -t '{up-of}'
bind L swap-pane -t '{right-of}'
